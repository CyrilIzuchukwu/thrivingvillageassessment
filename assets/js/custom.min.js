/** Core script to handle the entire theme and core functions **/
var Tixia = function () {

  /* Search Bar ============ */
  var screenWidth = $(window).width();

  var handleSelectPicker = function () {
    if (jQuery('.default-select,.dataTables_wrapper select').length > 0) {
      jQuery('.default-select,.dataTables_wrapper select').selectpicker();
    }
  }

  var handleTheme = function () {
    $('#preloader').fadeOut(500);
    $('#main-wrapper').addClass('show');
  }

  var handleMetisMenu = function () {
    if (jQuery('#menu').length > 0) {
      $("#menu").metisMenu();
    }
    jQuery('.metismenu > .mm-active ').each(function () {
      if (!jQuery(this).children('ul').length > 0) {
        jQuery(this).addClass('active-no-child');
      }
    });
  }




  var handleAllChecked = function () {
    $("#checkAll, #checkAll4, #checkAll1, #checkAll2, #checkAll5").on('change', function () {
      $("td input, .email-list .custom-checkbox input").prop('checked', $(this).prop("checked"));
    });
    $(".checkAllInput").on('click', function () {
      jQuery(this).closest('.ItemsCheckboxSec').find('input[type="checkbox"]').prop('checked', true);
    });
    $(".unCheckAllInput").on('click', function () {
      jQuery(this).closest('.ItemsCheckboxSec').find('input[type="checkbox"]').prop('checked', false);
    });
  }
  var setCurrentYear = function () {
    const currentDate = new Date();
    let currentYear = currentDate.getFullYear();
    let elements = document.getElementsByClassName('current-year');

    for (const element of elements) {
      element.innerHTML = currentYear;
    }

  }


  // var handleNavigation = function () {
  //   $(".nav-control").on('click', function () {

  //     $('#main-wrapper').toggleClass("menu-toggle");

  //     $(".hamburger").toggleClass("is-active");
  //   });
  // }

  // var handleNavigation = function () {
  //   $(".nav-control").on('click', function () {
  //     $('#main-wrapper').toggleClass("menu-toggle");
  //     $(".hamburger").toggleClass("is-active");
  //     $(".menu-overlay").toggleClass("active");
  //     $(".close-sidebar").toggleClass("active");
  //   });

  //   $(".close-sidebar, .menu-overlay").on('click', function () {
  //     $('#main-wrapper').removeClass("menu-toggle");
  //     $(".hamburger").removeClass("is-active");
  //     $(".menu-overlay").removeClass("active");
  //     $(".close-sidebar").removeClass("active");
  //   });
  // }

  // var handleNavigation = function () {
  //   $(".nav-control").on('click', function () {
  //     $('#main-wrapper').toggleClass("menu-toggle");
  //     $(".hamburger").toggleClass("is-active").toggle(); // Hide hamburger when active
  //     $(".menu-overlay").toggleClass("active");
  //     $(".close-sidebar").toggleClass("active"); // Show close button
  //   });

  //   $(".close-sidebar, .menu-overlay").on('click', function () {
  //     $('#main-wrapper').removeClass("menu-toggle");
  //     $(".hamburger").removeClass("is-active").show(); // Show hamburger when sidebar is closed
  //     $(".menu-overlay").removeClass("active");
  //     $(".close-sidebar").removeClass("active"); // Hide close button
  //   });
  // }


  var handleNavigation = function () {
    $(".nav-control").on('click', function () {
      $('#main-wrapper').toggleClass("menu-toggle");

      if ($('#main-wrapper').hasClass("menu-toggle")) {
        $(".hamburger").hide(); // Hide hamburger when sidebar opens
        $(".menu-overlay").addClass("active");
        $(".close-sidebar").addClass("active"); // Ensure close button is visible
      } else {
        $(".hamburger").show(); // Show hamburger when sidebar closes
        $(".menu-overlay").removeClass("active");
        $(".close-sidebar").removeClass("active"); // Hide close button
      }
    });

    $(".close-sidebar, .menu-overlay").on('click', function () {
      $('#main-wrapper').removeClass("menu-toggle");
      $(".hamburger").show(); // Show hamburger when sidebar closes
      $(".menu-overlay").removeClass("active");
      $(".close-sidebar").removeClass("active"); // Hide close button
    });
  };



  var handleSidebarOverlay = function () {
    if (!$(".menu-overlay").length) {
      $("body").append('<div class="menu-overlay"></div>'); // Ensure overlay exists
    }
    if (!$(".close-sidebar").length) {
      $(".body").prepend('<div class="close-sidebar"><i class="ri-close-line"></i></div>'); // Ensure close button exists
    }
  };

  var handleCurrentActive = function () {
    for (var nk = window.location,
      o = $("ul#menu a").filter(function () {
        return this.href == nk;
      })
        .addClass("mm-active")
        .parent()
        .addClass("mm-active"); ;) {
      // console.log(o)
      if (!o.is("li")) break;
      o = o.parent()
        .addClass("mm-show")
        .parent()
        .addClass("mm-active");
    }
  }


  var handleCustomFileInput = function () {
    $(".custom-file-input").on("change", function () {
      var fileName = $(this).val().split("\\").pop();
      $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });
  }

  var handleMiniSidebar = function () {
    $("ul#menu>li").on('click', function () {
      const sidebarStyle = $('body').attr('data-sidebar-style');
      if (sidebarStyle === 'mini') {
        console.log($(this).find('ul'))
        $(this).find('ul').stop()
      }
    })
  }

  var handleMinHeight = function () {
    function handleHeight() {
      var win_h = window.innerHeight;
      if (win_h > 0 ? win_h : screen.height) {
        setTimeout(() => {
          $(".content-body").css("min-height", (window.innerHeight - 63) + "px");
          if ($('body').attr('data-layout') === "vertical") {
            if (
              ($('body').attr('data-sidebar-style') === "mini") && ($('.deznav .deznav-scroll').height() > (window.innerHeight - 60))
              ||
              ($('body').attr('data-sidebar-style') === "modern") && ($('.deznav .deznav-scroll').height() > (window.innerHeight - 60))
              ||
              ($('body').attr('data-sidebar-style') === "full") && $('#main-wrapper').hasClass('menu-toggle') && ($('.deznav .deznav-scroll').height() > (window.innerHeight - 60))
            ) {
              $(".content-body").css("min-height", ($('.deznav .deznav-scroll').height() + 110) + "px");
            }
          }
        }, 1000);
      };

      setTimeout(() => {
        if (
          $('body').attr('data-header-position') === "fixed"
          &&
          $('body').attr('data-layout') === "horizontal"
          &&
          $('body').attr('data-sidebar-position') === "fixed"
        ) {
          $('.content-body').css("padding-top", ($('.deznav').height() + $('.header').height()) + 'px');
        } else if (
          $('body').attr('data-header-position') === "fixed"
          &&
          $('body').attr('data-layout') === "horizontal"
          &&
          $('body').attr('data-sidebar-position') === "static"
        ) {
          $('.content-body').css("padding-top", $('.header').height() + "px");
        } else if (
          $('body').attr('data-header-position') === "static"
          &&
          $('body').attr('data-layout') === "horizontal"
          &&
          $('body').attr('data-sidebar-position') === "fixed"
        ) {
          $('.content-body').css("padding-top", "0px");
        } else {
          $('.content-body').css("padding-top", "");
        }
      }, 400);
    }
    handleHeight();
    var element = document.querySelector('body');
    var element2 = document.querySelector('#main-wrapper');
    var observer = new MutationObserver(function (mutations) {
      mutations.forEach(function (mutation) {
        if ((mutation.attributeName === "data-sidebar-style") || (mutation.attributeName === "class")) {
          handleHeight();
        }
      });
    });
    observer.observe(element, {
      attributes: true
    });
    observer.observe(element2, {
      attributes: true
    });

  }

  var handleDataAction = function () {
    $('a[data-action="collapse"]').on("click", function (i) {
      i.preventDefault(),
        $(this).closest(".card").find('[data-action="collapse"] i').toggleClass("mdi-arrow-down mdi-arrow-up"),
        $(this).closest(".card").children(".card-body").collapse("toggle");
    });

    $('a[data-action="expand"]').on("click", function (i) {
      i.preventDefault(),
        $(this).closest(".card").find('[data-action="expand"] i').toggleClass("icon-size-actual icon-size-fullscreen"),
        $(this).closest(".card").toggleClass("card-fullscreen");
    });



    $('[data-action="close"]').on("click", function () {
      $(this).closest(".card").removeClass().slideUp("fast");
    });

    $('[data-action="reload"]').on("click", function () {
      var e = $(this);
      e.parents(".card").addClass("card-load"),
        e.parents(".card").append('<div class="card-loader"><i class=" ti-reload rotate-refresh"></div>'),
        setTimeout(function () {
          e.parents(".card").children(".card-loader").remove(),
            e.parents(".card").removeClass("card-load")
        }, 2000)
    });
  }

  var handleHeaderHight = function () {
    const headerHight = $('.header').innerHeight();
    $(window).scroll(function () {
      if ($('body').attr('data-layout') === "horizontal" && $('body').attr('data-header-position') === "static" && $('body').attr('data-sidebar-position') === "fixed")
        $(this.window).scrollTop() >= headerHight ? $('.deznav').addClass('fixed') : $('.deznav').removeClass('fixed')
    });
  }



  // var handleMenuTabs = function () {
  //   if (screenWidth <= 991) {
  //     jQuery('.menu-tabs .nav-link').on('click', function () {
  //       if (jQuery(this).hasClass('open')) {
  //         jQuery(this).removeClass('open');
  //         jQuery('.fixed-content-box').removeClass('active');
  //         jQuery('.hamburger').show();
  //       } else {
  //         jQuery('.menu-tabs .nav-link').removeClass('open');
  //         jQuery(this).addClass('open');
  //         jQuery('.fixed-content-box').addClass('active');
  //         jQuery('.hamburger').hide();
  //       }
  //       //jQuery('.fixed-content-box').toggleClass('active');
  //     });
  //     jQuery('.close-fixed-content').on('click', function () {
  //       jQuery('.fixed-content-box').removeClass('active');
  //       jQuery('.hamburger').removeClass('is-active');
  //       jQuery('#main-wrapper').removeClass('menu-toggle');
  //       jQuery('.hamburger').show();
  //     });
  //   }
  // }

  var handleMenuTabs = function () {
    if (screenWidth <= 991) {
      jQuery('.menu-tabs .nav-link').on('click', function () {
        if (jQuery(this).hasClass('open')) {
          jQuery(this).removeClass('open');
          jQuery('.fixed-content-box').removeClass('active');
          jQuery('.hamburger').show();
        } else {
          jQuery('.menu-tabs .nav-link').removeClass('open');
          jQuery(this).addClass('open');
          jQuery('.fixed-content-box').addClass('active');
          jQuery('.hamburger').hide();
        }
      });

      jQuery('.close-fixed-content, .menu-overlay').on('click', function () {
        jQuery('.fixed-content-box').removeClass('active');
        jQuery('.hamburger').removeClass('is-active');
        jQuery('#main-wrapper').removeClass('menu-toggle');
        jQuery('.menu-overlay').removeClass('active');
        jQuery('.hamburger').show();
      });
    }
  }





  var handleshowPass = function () {
    jQuery('.show-pass').on('click', function () {
      jQuery(this).toggleClass('active');
      if (jQuery('#dz-password').attr('type') == 'password') {
        jQuery('#dz-password').attr('type', 'text');
      } else if (jQuery('#dz-password').attr('type') == 'text') {
        jQuery('#dz-password').attr('type', 'password');
      }
    });
  }



  /* Function ============ */
  return {
    init: function () {
      handleSelectPicker();
      handleTheme();
      handleMetisMenu();
      handleAllChecked();
      handleNavigation();
      handleSidebarOverlay();
      handleCurrentActive();
      handleMinHeight();
      handleDataAction();
      handleHeaderHight();
      handleMenuTabs();
      vHeight();
      setCurrentYear();
    },

    load: function () {
      handleSelectPicker();
      handleTheme();
      handleEventSidebar();
    },

    resize: function () {
      screenWidth = $(window).width();
      //vHeight();
      handleEventSidebar();
    }
  }

}();

/* Document.ready Start */
jQuery(document).ready(function () {
  $('[data-bs-toggle="popover"]').popover();

  $('.btn-follow').click(function () {
    if ($(this).hasClass('active')) {
      $(this).removeClass('active').html('<i class="la la-user me-1 fs-14"></i> Follow');
    } else {
      $(this).addClass('active').html('<i class="la la-check me-1 fs-14"></i> Following');
    }
  });

  $('.post-like').click(function () {
    $(this).toggleClass('active');
  });

});
/* Document.ready END */

jQuery(document).ready(function () {
  $('[data-bs-toggle="popover"]').popover();
  'use strict';
  Tixia.init();

});
/* Window Load START */
jQuery(window).on('load', function () {
  'use strict';
  Tixia.load();
});


jQuery(window).on('resize', function () {
  'use strict';
  Tixia.resize();
});